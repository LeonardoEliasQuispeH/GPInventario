<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Lista de Usuarios</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
</head>
<body>
<div class="container mt-5">

    <!-- Título centrado -->
    <div class="text-center mb-4">
        <h3>Lista de Usuarios</h3>
    </div>

    <!-- Mensaje de éxito o error -->
    <div th:if="${exito}" class="alert alert-success alert-dismissible fade show" role="alert">
        <span th:text="${exito}"></span>
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    </div>
    <div th:if="${error}" class="alert alert-danger alert-dismissible fade show" role="alert">
        <span th:text="${error}"></span>
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    </div>

    <!-- Botón añadir -->
    <div class="mb-3">
        <a href="/usuarios/nuevo" class="btn btn-success me-2">Añadir Usuario</a>
    </div>

    <!-- Tabla responsiva -->
    <div class="table-responsive">
        <table class="table table-striped table-bordered align-middle">
            <thead class="table-dark text-center">
                <tr>
                    <th class="text-center">ID</th>
                    <th class="text-center">Nombre</th>
                    <th class="text-center">Apellido</th>
                    <th class="text-center">DNI</th>
                    <th class="text-center">Celular</th>
                    <th class="text-center">Estado</th>
                    <th class="text-center">Acciones</th>
                </tr>
            </thead>
            <tbody>
                <tr th:each="usuario : ${usuarios}">
                    <td class="text-center" th:text="${usuario.id}"></td>
                    <td class="text-center" th:text="${usuario.nombre}"></td>
                    <td class="text-center" th:text="${usuario.apellido}"></td>
                    <td class="text-center" th:text="${usuario.dni}"></td>
                    <td class="text-center" th:text="${usuario.celular}"></td>

                    <!-- Columna Estado: toggle switch centrado -->
                    <td class="text-center">
                        <div class="form-check form-switch d-flex justify-content-center align-items-center m-0">
                            <input class="form-check-input" type="checkbox"
                                   th:checked="${usuario.estado == 'Activo'}"
                                   th:id="'switch-' + ${usuario.id}"
                                   th:data-id="${usuario.id}">
                            <label class="form-check-label ms-2 mb-0" th:for="'switch-' + ${usuario.id}"
                                   th:text="${usuario.estado}"></label>
                        </div>
                    </td>

                    <!-- Columna Acciones -->
                    <td class="text-center">
                        <!-- Editar -->
                        <a th:href="@{'/usuarios/editar/' + ${usuario.id}}" class="text-primary me-2" title="Editar">
                            <i class="bi bi-pencil-fill"></i>
                        </a>

                        <!-- Reestablecer contraseña -->
                        <a th:href="@{'/usuarios/reestablecer/' + ${usuario.id}}" class="text-warning me-2" title="Reestablecer contraseña">
                            <i class="bi bi-key-fill"></i>
                        </a>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>

</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
document.querySelectorAll('.form-check-input').forEach(switchEl => {
    switchEl.addEventListener('change', function() {
        const id = this.getAttribute('data-id');
        const activo = this.checked;

        fetch(`/usuarios/cambiar-estado/${id}?activo=${activo}`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/x-www-form-urlencoded'
            }
        })
        .then(() => location.reload()) // recarga la página para actualizar mensajes
        .catch(() => alert("Error al actualizar el estado del usuario."));
    });
});
</script>

</body>
</html>
